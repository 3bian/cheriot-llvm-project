// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// RUN: %cheri_purecap_cc1 -o - -O0 -emit-llvm %s | FileCheck %s
// Ensure that the code below doesn't crash due to the __cheri_tocap to void*
// Found after https://github.com/CTSRD-CHERI/cheribsd/commit/58379f87eda5569d6aae0d36154549725b50c1b2
// See https://github.com/CTSRD-CHERI/clang/issues/178
struct a {
  void *ptr;
};
// CHECK-LABEL: @c(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[FIRST:%.*]] = alloca [[STRUCT_A:%.*]], align 16, addrspace(200)
// CHECK-NEXT:    [[SECOND:%.*]] = alloca [[STRUCT_A]], align 16, addrspace(200)
// CHECK-NEXT:    [[PTR:%.*]] = getelementptr inbounds [[STRUCT_A]], ptr addrspace(200) [[FIRST]], i32 0, i32 0
// CHECK-NEXT:    store ptr addrspace(200) [[SECOND]], ptr addrspace(200) [[PTR]], align 16
// CHECK-NEXT:    ret void
//
void c(void) {
  struct a first;
  struct a second;
  first.ptr = (__cheri_tocap void *)&second;
}
