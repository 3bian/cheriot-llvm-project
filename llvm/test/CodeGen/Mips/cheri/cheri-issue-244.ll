; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
;; Regression test for assertion: Assertion failed: (Ty->isSized() && "Cannot getTypeInfo() on a type that is unsized!")
;; https://github.com/CTSRD-CHERI/llvm/issues/244
; RUN: %cheri_purecap_llc %s -o - | FileCheck %s

%struct.b = type { ptr addrspace(200) }

@e = local_unnamed_addr addrspace(200) global %struct.b { ptr addrspace(200) @c }, align 32

; Function Attrs: nounwind
define internal i32 @c() addrspace(200) nounwind {
; CHECK-LABEL: c:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    cincoffset $c11, $c11, -32
; CHECK-NEXT:    csc $c17, $zero, 16($c11) # 16-byte Folded Spill
; CHECK-NEXT:    lui $1, %pcrel_hi(_CHERI_CAPABILITY_TABLE_-8)
; CHECK-NEXT:    daddiu $1, $1, %pcrel_lo(_CHERI_CAPABILITY_TABLE_-4)
; CHECK-NEXT:    cgetpccincoffset $c1, $1
; CHECK-NEXT:    clcbi $c2, %captab20(c)($c1)
; CHECK-NEXT:    csc $c2, $zero, 0($c11)
; CHECK-NEXT:    csetbounds $c2, $c11, 16
; CHECK-NEXT:    clcbi $c12, %capcall20(dladdr)($c1)
; CHECK-NEXT:    ori $1, $zero, 65495
; CHECK-NEXT:    cjalr $c12, $c17
; CHECK-NEXT:    candperm $c13, $c2, $1
; CHECK-NEXT:    clc $c17, $zero, 16($c11) # 16-byte Folded Reload
; CHECK-NEXT:    cjr $c17
; CHECK-NEXT:    cincoffset $c11, $c11, 32
entry:
  %call = tail call addrspace(200) i32 (...) @dladdr(ptr addrspace(200) inreg @c) nounwind
  ret i32 %call
}

declare i32 @dladdr(...) addrspace(200) nounwind
