; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -passes=instcombine -S < %s | FileCheck %s
target datalayout = "pf200:128:128:128:64"
target triple = "riscv64-unknown-freebsd"

define i32 @main() {
; CHECK-LABEL: @main(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[CALL:%.*]] = call ptr @malloc(i64 zeroext 168)
; CHECK-NEXT:    [[TMP0:%.*]] = addrspacecast ptr [[CALL]] to ptr addrspace(200)
; CHECK-NEXT:    call void @test(ptr addrspace(200) [[TMP0]])
; CHECK-NEXT:    [[ADD_PTR:%.*]] = getelementptr inbounds i32, ptr addrspace(200) [[TMP0]], i64 41
; CHECK-NEXT:    call void @test(ptr addrspace(200) nonnull [[ADD_PTR]])
; CHECK-NEXT:    ret i32 0
;
entry:
  ; Check that the address space cast happens before the GEP.
  %call = call ptr @malloc(i64 zeroext 168)
  %0 = bitcast ptr %call to ptr
  %1 = addrspacecast ptr %0 to ptr addrspace(200)
  call void @test(ptr addrspace(200) %1)
  %add.ptr = getelementptr inbounds i32, ptr addrspace(200) %1, i64 41
  call void @test(ptr addrspace(200) %add.ptr)
  ret i32 0
}

declare ptr @malloc(i64 zeroext)

declare void @test(ptr addrspace(200))
